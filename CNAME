<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deer Feeder Dashboard</title>
<style>
    body { font-family: Arial; margin: 0; padding: 0; }
    nav { background: #333; color: white; padding: 10px; }
    nav ul { list-style: none; display: flex; gap: 20px; margin: 0; }
    nav a { color: white; text-decoration: none; cursor: pointer; }
    .hidden { display: none; }
    .tab-content { padding: 20px; display: none; }
    .active { display: block; }

    /* Lock Screen */
    #lockscreen {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.85);
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        text-align: center;
        padding: 20px;
    }
    #lockscreen input, #lockscreen button {
        padding: 10px;
        margin: 8px;
        width: 250px;
    }
    #success-check {
        font-size: 40px;
        color: limegreen;
        display: none;
        margin-top: 10px;
    }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    #logTableContainer, #unitListContainer, #masterUnitListContainer, #userTableContainer {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #aaa;
        padding: 10px;
        margin-top: 10px;
    }

    input[type=text], input[type=email], input[type=password] { width: 250px; padding: 5px; margin: 5px 0; }
    button { padding: 8px 15px; margin: 5px 0; }

    #editCustomNameForm { display:none; margin-top: 20px; padding:10px; border:1px solid #ccc; max-width:400px; }
    #editCustomNameForm input { width: 100%; }
</style>
</head>
<body>

<!-- LOCK SCREEN -->
<div id="lockscreen">
    <h1>Login Required</h1>
    <input type="text" id="loginUsername" placeholder="Username">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>

    <h2>— OR REGISTER —</h2>
    <input type="text" id="regUser" placeholder="New Username">
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regPass" placeholder="New Password">
    <button onclick="registerUser()">Register</button>

    <div id="success-check">✔ Registration Successful!</div>
</div>

<!-- NAVIGATION -->
<nav>
  <ul>
    <li><a onclick="switchTab('home')">Home</a></li>
    <li id="addFeederTab"><a onclick="switchTab('add-feeder')">Add Feeder</a></li>
    <li id="dailyFeedTab"><a onclick="switchTab('daily-feed')">Daily Feed</a></li>
    <li id="specialFeedTab"><a onclick="switchTab('special-feed')">Special Feed</a></li>
    <li id="feederLogsTab"><a onclick="switchTab('feeder-logs')">Feeder Logs</a></li>
    <li id="masterTab" class="hidden"><a onclick="switchTab('user-data')">User Logins</a></li>
    <li id="masterAddTab" class="hidden"><a onclick="switchTab('master-add-units')">Add Units (Master)</a></li>
  </ul>
</nav>

<!-- HOME -->
<div id="home" class="tab-content active">
  <h1>Welcome to Deer Feeder Dashboard</h1>
  <button id="homeLogoutBtn" onclick="logout()">Logout</button>

  <!-- MY FEEDERS -->
  <div id="myFeedersSection" class="hidden">
      <h2>My Feeders</h2>
      <ul id="myFeedersList"></ul>
  </div>

  <!-- EDIT CUSTOM NAME FORM -->
  <div id="editCustomNameForm">
      <h3>Change Custom Name</h3>
      <label>Old Name:</label>
      <input type="text" id="oldCustomName" disabled>
      <label>New Name:</label>
      <input type="text" id="newCustomName" placeholder="Enter new custom name">
      <button onclick="saveCustomName()">Save</button>
      <button onclick="cancelEdit()">Cancel</button>
  </div>
</div>

<!-- ADD FEEDER (Regular users) -->
<div id="add-feeder" class="tab-content">
    <h1>Add Feeder Unit</h1>
    <label>Unit Number:</label>
    <input type="text" id="userUnitInput" placeholder="Type unit number...">
    <label>Custom Name:</label>
    <input type="text" id="userUnitCustomName" placeholder="Enter a custom name for this unit">
    <button onclick="addUserUnit()">Add Unit to My Account</button>
    <div id="userUnitMessage" style="color:red; margin-top:5px;"></div>

    <h2>Existing Units (Your Account)</h2>
    <table id="unitTable">
        <tr>
            <th>Unit Number</th>
            <th>Custom Name</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<div id="daily-feed" class="tab-content">
  <h1>Daily Feed</h1>
</div>

<div id="special-feed" class="tab-content">
  <h1>Special Feed</h1>
</div>

<div id="feeder-logs" class="tab-content">
  <h1>Feeder Logs</h1>
  <div id="logTableContainer">
    <table>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Feeder Name</th>
        <th>Type of Feed</th>
        <th>Video</th>
      </tr>
    </table>
  </div>
</div>

<!-- MASTER ADD UNITS -->
<div id="master-add-units" class="tab-content">
    <h1>Master Add Units</h1>
    <form id="masterAddUnitForm">
        <label>Unit Number</label>
        <input type="text" id="masterUnitNumber" required>
        <button type="submit">Add Unit</button>
    </form>

    <h2>Search Units</h2>
    <input type="text" id="unitSearch" placeholder="Search by unit number..." onkeyup="searchMasterUnits()">

    <h2>Master Units</h2>
    <div id="masterUnitListContainer">
        <table id="masterUnitTable">
            <tr>
                <th>Unit Number</th>
                <th>Claimed By</th>
                <th>Custom Name</th>
                <th>Action</th>
            </tr>
        </table>
    </div>
</div>

<!-- MASTER USER LOGINS -->
<div id="user-data" class="tab-content">
  <h1>Registered Users</h1>
  <table id="userTable">
    <tr>
      <th>Username</th>
      <th>Email</th>
      <th>Password</th>
    </tr>
  </table>
</div>

<script>
let users = [];
let units = [];
let masterUnits = [];
const MASTER_CODE = "9999"; // Master password
let currentUser = "";
let isMaster = false;
let editingUnitNumber = "";

// TAB SWITCH
function switchTab(tabId) {
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    if(tabId==='home' && currentUser) updateMyFeeders();
}

// REGISTER USER
function registerUser() {
    let user = document.getElementById("regUser").value;
    let email = document.getElementById("regEmail").value;
    let pass = document.getElementById("regPass").value;
    if(!user || !email || !pass) { alert("Fill all fields"); return; }

    users.push({username:user,email:email,password:pass});
    document.getElementById("success-check").style.display = "block";
    setTimeout(()=>document.getElementById("success-check").style.display="none",2000);
    updateUserTable();
}

// LOGIN
function login() {
    let user = document.getElementById("loginUsername").value.trim();
    let pass = document.getElementById("loginPassword").value.trim();

    // MASTER LOGIN
    if (user === "Mastermode" && pass === MASTER_CODE) {
        isMaster = true;
        currentUser = "Mastermode";
        document.getElementById("lockscreen").style.display = "none";

        // Show master tabs
        document.getElementById("masterTab").classList.remove("hidden");
        document.getElementById("masterAddTab").classList.remove("hidden");

        // Hide regular user tab
        document.getElementById("addFeederTab").classList.add("hidden");

        // Hide Daily Feed, Special Feed, Feeder Logs
        document.getElementById("dailyFeedTab").classList.add("hidden");
        document.getElementById("specialFeedTab").classList.add("hidden");
        document.getElementById("feederLogsTab").classList.add("hidden");

        updateMyFeeders();
        return;
    }

    // REGULAR USER LOGIN
    let found = users.find(u => u.username === user && u.password === pass);

    if (found) {
        isMaster = false;
        currentUser = user;
        document.getElementById("lockscreen").style.display = "none";

        document.getElementById("masterTab").classList.add("hidden");
        document.getElementById("masterAddTab").classList.add("hidden");

        document.getElementById("addFeederTab").classList.remove("hidden");
        document.getElementById("dailyFeedTab").classList.remove("hidden");
        document.getElementById("specialFeedTab").classList.remove("hidden");
        document.getElementById("feederLogsTab").classList.remove("hidden");

        document.getElementById("myFeedersSection").classList.remove("hidden");
        updateMyFeeders();
    } else {
        alert("Incorrect username or password.");
    }
}

// LOGOUT
function logout() {
    currentUser = ""; isMaster=false;
    document.getElementById("lockscreen").style.display="flex";
    document.getElementById("masterTab").classList.add("hidden");
    document.getElementById("masterAddTab").classList.add("hidden");
    document.getElementById("addFeederTab").classList.remove("hidden");
    document.getElementById("dailyFeedTab").classList.remove("hidden");
    document.getElementById("specialFeedTab").classList.remove("hidden");
    document.getElementById("feederLogsTab").classList.remove("hidden");
    document.getElementById("myFeedersSection").classList.add("hidden");
    switchTab('home');
}

// USER TABLE
function updateUserTable() {
    let table = document.getElementById("userTable");
    table.innerHTML = `<tr><th>Username</th><th>Email</th><th>Password</th></tr>`;
    users.forEach(u=>{
        table.innerHTML+=`<tr><td>${u.username}</td><td>${u.email}</td><td>${u.password}</td></tr>`;
    });
}

// MASTER ADD UNITS
document.getElementById("masterAddUnitForm").addEventListener("submit", function(e){
    e.preventDefault();
    let number = document.getElementById("masterUnitNumber").value.trim();
    if(!number) return;

    masterUnits.push({number,claimedBy:"Unclaimed",customName:""});
    updateMasterUnitTable();
    document.getElementById("masterUnitNumber").value="";
});

// UPDATE MASTER UNITS
function updateMasterUnitTable(filteredUnits){
    let table = document.getElementById("masterUnitTable");
    table.innerHTML = `<tr><th>Unit Number</th><th>Claimed By</th><th>Custom Name</th><th>Action</th></tr>`;
    let list = filteredUnits || masterUnits;
    list.forEach((u, index) => {
        table.innerHTML += `<tr>
            <td>${u.number}</td>
            <td>${u.claimedBy}</td>
            <td>${u.customName||""}</td>
            <td><button onclick="deleteMasterUnit(${index})">Delete</button></td>
        </tr>`;
    });
}

// DELETE MASTER UNIT
function deleteMasterUnit(index){
    let code = prompt("Enter Master Code to delete this unit:");
    if(code === MASTER_CODE){
        masterUnits.splice(index,1);
        updateMasterUnitTable();
        alert("Unit deleted successfully!");
    } else {
        alert("Incorrect Master Code. Cannot delete unit.");
    }
}

// SEARCH MASTER UNITS
function searchMasterUnits(){
    let query=document.getElementById("unitSearch").value.toLowerCase();
    let filtered = masterUnits.filter(u=>u.number.toLowerCase().includes(query));
    updateMasterUnitTable(filtered);
}

// ADD UNIT FOR REGULAR USERS
function addUserUnit() {
    if(isMaster) return;
    let typedNumber = document.getElementById("userUnitInput").value.trim();
    let customName = document.getElementById("userUnitCustomName").value.trim();
    let msg = document.getElementById("userUnitMessage");

    if(!typedNumber || !customName) { msg.textContent="Enter unit number & custom name"; return; }

    let foundMasterUnit = masterUnits.find(u=>u.number===typedNumber);
    if(!foundMasterUnit) { msg.textContent="Unit not in system!"; return; }

    if(units.find(u=>u.number===typedNumber)) { msg.textContent="Already added this unit!"; return; }

    units.push({number:typedNumber,name:customName});
    foundMasterUnit.claimedBy=currentUser;
    foundMasterUnit.customName=customName;

    msg.textContent="";
    document.getElementById("userUnitInput").value="";
    document.getElementById("userUnitCustomName").value="";
    updateUnitTable();
    updateMasterUnitTable();
    updateMyFeeders();
}

// REMOVE UNIT (Regular users)
function removeUserUnit(unitNumber) {
    units = units.filter(u => u.number !== unitNumber);
    let masterUnit = masterUnits.find(u => u.number === unitNumber);
    if(masterUnit) { masterUnit.claimedBy="Unclaimed"; masterUnit.customName=""; }
    updateUnitTable();
    updateMyFeeders();
    updateMasterUnitTable();
}

// UPDATE UNIT TABLE
function updateUnitTable(){
    let table=document.getElementById("unitTable");
    table.innerHTML=`<tr><th>Unit Number</th><th>Custom Name</th><th>Action</th></tr>`;
    units.forEach(u=>{
        if(masterUnits.find(m=>m.number===u.number && m.claimedBy===currentUser)){
            table.innerHTML+=`<tr>
                <td>${u.number}</td>
                <td>${u.name||""}</td>
                <td><button onclick="removeUserUnit('${u.number}')">Remove</button></td>
            </tr>`;
        }
    });
}

// MY FEEDERS
function updateMyFeeders(){
    let list=document.getElementById("myFeedersList");
    list.innerHTML="";
    let myUnits=units.filter(u=>masterUnits.find(m=>m.number===u.number && m.claimedBy===currentUser));
    myUnits.sort((a,b)=> (a.name||"").localeCompare(b.name||""));
    myUnits.forEach(u=>{
        let li=document.createElement("li");
        li.textContent=u.name || "(No Name)";
        li.onclick=()=>showEditCustomName(u.number);
        li.style.cursor="pointer";
        list.appendChild(li);
    });
}

// EDIT CUSTOM NAME
function showEditCustomName(unitNumber){
    editingUnitNumber=unitNumber;
    let userUnit=units.find(u=>u.number===unitNumber);
    document.getElementById("oldCustomName").value=userUnit.name;
    document.getElementById("newCustomName").value="";
    document.getElementById("editCustomNameForm").style.display="block";
}
function saveCustomName(){
    let newName=document.getElementById("newCustomName").value.trim();
    if(!newName) return alert("Enter a new custom name");

    let userUnit=units.find(u=>u.number===editingUnitNumber);
    userUnit.name=newName;

    let masterUnit=masterUnits.find(u=>u.number===editingUnitNumber);
    if(masterUnit) masterUnit.customName=newName;

    updateMyFeeders();
    updateUnitTable();
    updateMasterUnitTable();
    cancelEdit();
}
function cancelEdit(){ editingUnitNumber=""; document.getElementById("editCustomNameForm").style.display="none"; }

// INIT MASTER UNITS FOR DEMO
masterUnits=[{number:"001",claimedBy:"",customName:""},{number:"002",claimedBy:"",customName:""},{number:"003",claimedBy:"",customName:""}];
</script>
</body>
</html>
